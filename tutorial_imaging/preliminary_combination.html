<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Preliminary combination &mdash; pyemir-tutorials v1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Improving the image combination" href="refined_combination.html" />
    <link rel="prev" title="Imaging mode tutorial: combination of dithered exposures" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyemir-tutorials
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../preliminaries/preliminaries.html">Preliminaries</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Imaging mode tutorial: combination of dithered exposures</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Preliminary combination</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-basic-reduction-of-individual-exposures">Step 1: basic reduction of individual exposures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-image-combination">Step 2: image combination</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="refined_combination.html">Improving the image combination</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_mos/index.html">Spectroscopic mode tutorial: MOS data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_flat/index.html">Flatfield generation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyemir-tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Imaging mode tutorial: combination of dithered exposures</a></li>
      <li class="breadcrumb-item active">Preliminary combination</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial_imaging/preliminary_combination.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="preliminary-combination">
<h1>Preliminary combination<a class="headerlink" href="#preliminary-combination" title="Permalink to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before continuing, make sure that you have already initialize the file tree
structure by following the instructions provided in the
<a class="reference internal" href="../preliminaries/preliminaries.html#initial-file-tree"><span class="std std-ref">Initial file tree</span></a> section of this documentation.</p>
</div>
<p>Assume you want to combine the following raw images obtained using a dithered
pattern of 7 positions iterated twice (i.e., you have gathered a total of 14
images):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0001877553</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877559</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877565</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877571</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877577</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877583</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877589</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877595</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877601</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877607</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877613</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877619</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877625</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="mi">0001877631</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p>Those files (together with some additional files that you will need to follow
this imaging example) are available as a compressed tgz file:
<a class="reference external" href="https://guaix.fis.ucm.es/data/pyemir/pyemir_imaging_tutorial_v4.tgz">pyemir_imaging_tutorial_v4.tgz</a>.</p>
<p>The preliminary combination of these 14 images will be carried out in two
steps:</p>
<ul class="simple">
<li><p><strong>Step 1:</strong> basic reduction of each individual image: bad-pixel masking,
flatfielding and reprojection (the latter only since PyEmir version 0.17.0)</p></li>
<li><p><strong>Step 2:</strong> actual combination of the images</p></li>
</ul>
<section id="step-1-basic-reduction-of-individual-exposures">
<h2>Step 1: basic reduction of individual exposures<a class="headerlink" href="#step-1-basic-reduction-of-individual-exposures" title="Permalink to this heading"></a></h2>
<p>Move to the directory where you have deployed the initial file tree structure
containing the basic PyEmir calibration files (see  <a class="reference internal" href="../preliminaries/preliminaries.html#initial-file-tree"><span class="std std-ref">Initial file tree</span></a>).</p>
<p>Decompress there the previously mentioned tgz file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ tar zxvf pyemir_imaging_tutorial_v4.tgz
...
...
(emir) $ rm pyemir_imaging_tutorial_v4.tgz
</pre></div>
</div>
<p>This action should have populated the file tree with the
14 scientific raw FITS (placed wihtin the <code class="docutils literal notranslate"><span class="pre">data</span></code>
subdirectory) and some additional auxiliary files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ tree
.
├── control.yaml
├── data
│   ├── 0001877553-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877559-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877565-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877571-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877577-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877583-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877589-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877595-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877601-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877607-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877613-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877619-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877625-20181217-EMIR-STARE_IMAGE.fits
│   ├── 0001877631-20181217-EMIR-STARE_IMAGE.fits
│   ├── master_bpm.fits
│   ├── master_dark_zeros.fits
│   ├── master_flat_ones.fits
│   ├── master_flat_spec.fits
│   ├── rect_wpoly_MOSlibrary_grism_H_filter_H.json
│   ├── rect_wpoly_MOSlibrary_grism_J_filter_J.json
│   ├── rect_wpoly_MOSlibrary_grism_K_filter_Ksp.json
│   ├── rect_wpoly_MOSlibrary_grism_LR_filter_HK.json
│   ├── rect_wpoly_MOSlibrary_grism_LR_filter_YJ.json
│   └── user_offsets.txt
├── dithered_ini.yaml
├── dithered_v0.yaml
├── dithered_v1.yaml
├── dithered_v2.yaml
├── dithered_v3.yaml
├── dithered_v4.yaml
└── dithered_v5.yaml
</pre></div>
</div>
<p>You can easily examine the header of the scientific FITS images using the
astropy utility <code class="docutils literal notranslate"><span class="pre">fitsheader</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ fitsheader data/0001877* \
  -k nobsblck -k obsblock -k nimgobbl -k imgobbl \
  -k nexp -k exp -k object -k exptime -k readmode \
  -k filter -k grism -k date-obs -k ra -k dec -f &gt; fitsheader_out.txt
</pre></div>
</div>
<p>The previous command generates a file <code class="docutils literal notranslate"><span class="pre">fitsheader_out.txt</span></code> with the contents
of some relevant FITS keywords extracted from the header of the images.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                   <span class="n">filename</span>                    <span class="n">NOBSBLCK</span> <span class="n">OBSBLOCK</span> <span class="n">NIMGOBBL</span> <span class="n">IMGOBBL</span> <span class="n">NEXP</span> <span class="n">EXP</span> <span class="n">OBJECT</span> <span class="n">EXPTIME</span>  <span class="n">READMODE</span> <span class="n">FILTER</span> <span class="n">GRISM</span>        <span class="n">DATE</span><span class="o">-</span><span class="n">OBS</span>             <span class="n">RA</span>           <span class="n">DEC</span>     
<span class="o">----------------------------------------------</span> <span class="o">--------</span> <span class="o">--------</span> <span class="o">--------</span> <span class="o">-------</span> <span class="o">----</span> <span class="o">---</span> <span class="o">------</span> <span class="o">--------</span> <span class="o">--------</span> <span class="o">------</span> <span class="o">-----</span> <span class="o">----------------------</span> <span class="o">------------</span> <span class="o">-------------</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877553</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">1</span>        <span class="mi">7</span>       <span class="mi">1</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">17</span><span class="n">T23</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mf">24.72</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">54.057</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">33.537</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877559</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">1</span>        <span class="mi">7</span>       <span class="mi">2</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">17</span><span class="n">T23</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mf">11.73</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">51.624</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">09.313</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877565</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">1</span>        <span class="mi">7</span>       <span class="mi">3</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">17</span><span class="n">T23</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mf">58.75</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">50.663</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">19.381</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877571</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">1</span>        <span class="mi">7</span>       <span class="mi">4</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">17</span><span class="n">T23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mf">35.22</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">52.125</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">01.301</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877577</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">1</span>        <span class="mi">7</span>       <span class="mi">5</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">24.35</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">53.964</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">08.879</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877583</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">1</span>        <span class="mi">7</span>       <span class="mi">6</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="n">T00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">14.53</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">49.484</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">51.913</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877589</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">1</span>        <span class="mi">7</span>       <span class="mi">7</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="n">T00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">02.60</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">52.125</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">41.302</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877595</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">2</span>        <span class="mi">7</span>       <span class="mi">1</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="n">T00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">54.89</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">54.057</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">33.537</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877601</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">2</span>        <span class="mi">7</span>       <span class="mi">2</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="n">T00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">41.91</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">51.624</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">09.313</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877607</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">2</span>        <span class="mi">7</span>       <span class="mi">3</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="n">T00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mf">27.88</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">50.663</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">19.381</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877613</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">2</span>        <span class="mi">7</span>       <span class="mi">4</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="n">T00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">05.41</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">52.125</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">01.350</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877619</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">2</span>        <span class="mi">7</span>       <span class="mi">5</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="n">T00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">54.53</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">53.964</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">08.879</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877625</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">2</span>        <span class="mi">7</span>       <span class="mi">6</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="n">T00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">44.71</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">49.484</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">51.913</span>
<span class="n">data</span><span class="o">/</span><span class="mi">0001877631</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>       <span class="mi">18</span>        <span class="mi">2</span>        <span class="mi">7</span>       <span class="mi">7</span>    <span class="mi">1</span>   <span class="mi">1</span>   <span class="n">TEST</span> <span class="mf">29.99926</span>     <span class="n">RAMP</span>  <span class="n">F1230</span>  <span class="n">OPEN</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="n">T00</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mf">31.73</span> <span class="mi">02</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">52.125</span> <span class="o">-</span><span class="mi">01</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">41.302</span>
</pre></div>
</div>
<p>Note that:</p>
<ul class="simple">
<li><p>the keyword <code class="docutils literal notranslate"><span class="pre">OBSBLOCK</span></code> gives the observing block number.</p></li>
<li><p>the keyword <code class="docutils literal notranslate"><span class="pre">NIMGOBBL</span></code> provides the total number of images in each
dithering pattern (7 in this case).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IMGOBBL</span></code> indicates the sequential number within each pattern. This number
runs from 1 to <code class="docutils literal notranslate"><span class="pre">NIMGOBBL</span></code>.</p></li>
<li><p>the keyword <code class="docutils literal notranslate"><span class="pre">NEXP</span></code> gives the number of exposures taken at each position in
the dithering pattern before moving to the next one. In this simple example
this number is 1.</p></li>
<li><p>the keyword <code class="docutils literal notranslate"><span class="pre">EXP</span></code> provides de sequential number at each position in the
dithering pattern. This number runs from 1 to <code class="docutils literal notranslate"><span class="pre">NEXP</span></code>.</p></li>
</ul>
<p>The first steps in the reduction process will be the bad-pixel mask,
flatfielding, and image reprojection.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember that the <code class="docutils literal notranslate"><span class="pre">numina</span></code> script is the interface with GTC pipelines.
In order to execute PyEmir recipes you should type something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ numina run &lt;observation_result_file.yaml&gt; -r &lt;requirements_file.yaml&gt;
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;observation_result_file.yaml&gt;</span></code> is an observation result file in
YAML format, and <code class="docutils literal notranslate"><span class="pre">&lt;requirements_files.yaml&gt;</span></code> is a requirements file, also
in YAML format.</p>
<p>YAML is a human-readable data serialization language (for details see
<a class="reference external" href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html">YAML Syntax</a>)</p>
</div>
<p>The deployed file tree already contains the files required
to execute the initial reduction recipe needed in this case: the observation
result file <code class="docutils literal notranslate"><span class="pre">dithered_ini.yaml</span></code> and the requirements file <code class="docutils literal notranslate"><span class="pre">control.yaml</span></code>.
Let’s have a look to each of them separately.</p>
<p><strong>The observation result file:</strong> <code class="docutils literal notranslate"><span class="pre">dithered_ini.yaml</span></code></p>
<p>This is what we call an observation result file, which basically contains the
reduction recipes to be applied and the images involved. Note that this
particular file contains 14 blocks, one for each individual image.</p>
<p>Each block is separated by a line containing just three dashes (<code class="docutils literal notranslate"><span class="pre">---</span></code>):</p>
<ul class="simple">
<li><p>Do not forget the separation line <code class="docutils literal notranslate"><span class="pre">---</span></code> between blocks (otherwise the
pipeline will not recognize where one block ends and the next one begins).</p></li>
<li><p>This separation line must not appear after the last block.</p></li>
</ul>
<p>The contents of this file is displayed below,
highlighting the first block (first eight lines):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos">  1</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877553</span>
</span><span class="hll"><span class="linenos">  2</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
</span><span class="hll"><span class="linenos">  3</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
</span><span class="hll"><span class="linenos">  4</span><span class="n">frames</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">  5</span> <span class="o">-</span> <span class="mi">0001877553</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
</span><span class="hll"><span class="linenos">  6</span><span class="n">requirements</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">  7</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
</span><span class="hll"><span class="linenos">  8</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
</span><span class="linenos">  9</span><span class="o">---</span>
<span class="linenos"> 10</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877559</span>
<span class="linenos"> 11</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 12</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 13</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 14</span> <span class="o">-</span> <span class="mi">0001877559</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 15</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 16</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 17</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos"> 18</span><span class="o">---</span>
<span class="linenos"> 19</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877565</span>
<span class="linenos"> 20</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 21</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 22</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 23</span> <span class="o">-</span> <span class="mi">0001877565</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 24</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 25</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 26</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos"> 27</span><span class="o">---</span>
<span class="linenos"> 28</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877571</span>
<span class="linenos"> 29</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 30</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 31</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 32</span> <span class="o">-</span> <span class="mi">0001877571</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 33</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 34</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 35</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos"> 36</span><span class="o">---</span>
<span class="linenos"> 37</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877577</span>
<span class="linenos"> 38</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 39</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 40</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 41</span> <span class="o">-</span> <span class="mi">0001877577</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 42</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 43</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 44</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos"> 45</span><span class="o">---</span>
<span class="linenos"> 46</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877583</span>
<span class="linenos"> 47</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 48</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 49</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 50</span> <span class="o">-</span> <span class="mi">0001877583</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 51</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 52</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 53</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos"> 54</span><span class="o">---</span>
<span class="linenos"> 55</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877589</span>
<span class="linenos"> 56</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 57</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 58</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 59</span> <span class="o">-</span> <span class="mi">0001877589</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 60</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 61</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 62</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos"> 63</span><span class="o">---</span>
<span class="linenos"> 64</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877595</span>
<span class="linenos"> 65</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 66</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 67</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 68</span> <span class="o">-</span> <span class="mi">0001877595</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 69</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 70</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 71</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos"> 72</span><span class="o">---</span>
<span class="linenos"> 73</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877601</span>
<span class="linenos"> 74</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 75</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 76</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 77</span> <span class="o">-</span> <span class="mi">0001877601</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 78</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 79</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 80</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos"> 81</span><span class="o">---</span>
<span class="linenos"> 82</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877607</span>
<span class="linenos"> 83</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 84</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 85</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 86</span> <span class="o">-</span> <span class="mi">0001877607</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 87</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 88</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 89</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos"> 90</span><span class="o">---</span>
<span class="linenos"> 91</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877613</span>
<span class="linenos"> 92</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 93</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 94</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 95</span> <span class="o">-</span> <span class="mi">0001877613</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 96</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 97</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 98</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos"> 99</span><span class="o">---</span>
<span class="linenos">100</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877619</span>
<span class="linenos">101</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos">102</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos">103</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos">104</span> <span class="o">-</span> <span class="mi">0001877619</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos">105</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos">106</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos">107</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos">108</span><span class="o">---</span>
<span class="linenos">109</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877625</span>
<span class="linenos">110</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos">111</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos">112</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos">113</span> <span class="o">-</span> <span class="mi">0001877625</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos">114</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos">115</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos">116</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
<span class="linenos">117</span><span class="o">---</span>
<span class="linenos">118</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877631</span>
<span class="linenos">119</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos">120</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos">121</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos">122</span> <span class="o">-</span> <span class="mi">0001877631</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos">123</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos">124</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos">125</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">id</span></code> value is an arbitrary label that is employed to generate the name
of two auxiliary subdirectories. In this example the reduction of the first
block will generate two subdirectories named <code class="docutils literal notranslate"><span class="pre">obsid_0001877553_work</span></code> and
<code class="docutils literal notranslate"><span class="pre">obsid_0001877553_results</span></code>, where the intermediate results and the final
results are going to be stored, respectively. Note that we have arbitrarily
chosen the 10 digits of the unique running number assigned to each image
obtained with the GTC to build the label.</p></li>
<li><p>Not surprisingly, the key <code class="docutils literal notranslate"><span class="pre">instrument</span></code> is set to EMIR (do not forget that
Numina is at present also employed to reduce MEGARA data, and hopefully,
future GTC instruments).</p></li>
<li><p>The key <code class="docutils literal notranslate"><span class="pre">mode</span></code> indicates the identification of the reduction recipe
(<code class="docutils literal notranslate"><span class="pre">STARE_IMAGE</span></code> in this example).</p></li>
<li><p>The key <code class="docutils literal notranslate"><span class="pre">frames</span></code> lists the images to be combined prior to the execution of
the reduction recipe. In this case a single image has been obtained at each
point of the dithering pattern before moving to the next location within the
pattern. For that reason a single image appears in each block.</p></li>
<li><p>The key <code class="docutils literal notranslate"><span class="pre">requirements</span></code> is employed to pass additional parameters to the
reduction recipe. In this case, we are specifying the reprojection method to
be employed in order to correct the images from distortions prior to their
final combination. Since the reprojection is performed using the package
<a class="reference external" href="https://reproject.readthedocs.io/en/stable/">reproject</a> we can choose
between the different resampling algorithms implemented in that package:
valid values are: <code class="docutils literal notranslate"><span class="pre">none</span></code> (no reprojection is performed; this leads to bad
results when combining dithered images, specially at the final image
borders), <code class="docutils literal notranslate"><span class="pre">interp</span></code> (fastest reprojection method), <code class="docutils literal notranslate"><span class="pre">adaptive</span></code>, or
<code class="docutils literal notranslate"><span class="pre">exact</span></code> (slowest). Please, have a look to the documentation in the
<a class="reference external" href="https://reproject.readthedocs.io/en/stable/">reproject</a> package if you
need additional information concerning the reprojetion methods. In this
example we are using <code class="docutils literal notranslate"><span class="pre">interp</span></code>, which provides
good results. PyEmir users can try to use the slower <code class="docutils literal notranslate"><span class="pre">adaptive</span></code> or
<code class="docutils literal notranslate"><span class="pre">exact</span></code> methods and compare the final combined images to check for the
impact of the adopted method (we do not expect important differences).</p></li>
<li><p>The key <code class="docutils literal notranslate"><span class="pre">enabled:</span> <span class="pre">True</span></code> indicates that this block is going to be reduced.
As it is going to be shown later, the user can easily
activate/deactivate the execution of particular reduction recipes (i.e.
blocks in this file) just by modifying this flag.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Since the generation of the file <code class="docutils literal notranslate"><span class="pre">dithered_ini.yaml</span></code> can be cumbersome,
specially
when the number of images is large, an auxiliary script has been
incorporated in PyEmir in order to help in its generation.</p>
<p>In particular, the file used in this example can be easily created using a
few simple commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ cd data/
(emir) $ ls 0001877*fits &gt; list_images.txt
(emir) $ cd ..
(emir) $ pyemir-generate_yaml_for_dithered_image \
  data/list_images.txt --step 0 --repeat 1 \
  --reprojection interp \
  --outfile dithered_ini.yaml
</pre></div>
</div>
<p>Note that a temporary file <code class="docutils literal notranslate"><span class="pre">list_images.txt</span></code> is created with a list of the
the individual exposures. The script
<code class="docutils literal notranslate"><span class="pre">pyemir-generate_yaml_for_dithered_image</span></code> reads that file and generates
the observation result file <code class="docutils literal notranslate"><span class="pre">dithered_ini.yaml</span></code>.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">--step</span> <span class="pre">0</span></code>
indicates that the reduction recipe to be used here is <code class="docutils literal notranslate"><span class="pre">STARE_IMAGE</span></code>,
which corresponds to the preliminary image reduction.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">--repeat</span> <span class="pre">1</span></code> indicates that there is only a single exposure
at each telescope pointing within the dithering pattern. In a general case
this number can be greater than one (check the <code class="docutils literal notranslate"><span class="pre">NEXP</span></code> keyword in the FITS
header of the images; this is one of the keywords included in the file
<code class="docutils literal notranslate"><span class="pre">fitsheader_out.txt</span></code> generated above).</p>
<p>The reprojection method is also indicated by <code class="docutils literal notranslate"><span class="pre">--reprojection</span> <span class="pre">interp</span></code>,
where the valid options are <code class="docutils literal notranslate"><span class="pre">none</span></code>, <code class="docutils literal notranslate"><span class="pre">interp</span></code>, <code class="docutils literal notranslate"><span class="pre">adaptive</span></code> or <code class="docutils literal notranslate"><span class="pre">exact</span></code>.</p>
</div>
<p><strong>The requirements file:</strong> <code class="docutils literal notranslate"><span class="pre">control.yaml</span></code></p>
<p>This is the requirements file, containing the expected name of generic
calibration files. You do not need to modify anything here.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">version</span><span class="p">:</span> <span class="mi">1</span>
<span class="linenos"> 2</span><span class="n">products</span><span class="p">:</span>
<span class="linenos"> 3</span>  <span class="n">EMIR</span><span class="p">:</span>
<span class="linenos"> 4</span>    <span class="mi">225</span><span class="n">fcaf2</span><span class="o">-</span><span class="mi">7</span><span class="n">f6f</span><span class="o">-</span><span class="mi">49</span><span class="n">cc</span><span class="o">-</span><span class="mi">972</span><span class="n">a</span><span class="o">-</span><span class="mi">70</span><span class="n">fd0aee8e96</span><span class="p">:</span>  <span class="c1"># original EMIR detector</span>
<span class="linenos"> 5</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterBadPixelMask&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;master_bpm.fits&#39;</span><span class="p">}</span>
<span class="linenos"> 6</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterDark&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;master_dark_zeros.fits&#39;</span><span class="p">}</span>
<span class="linenos"> 7</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterIntensityFlat&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;master_flat_spec.fits&#39;</span><span class="p">}</span>
<span class="linenos"> 8</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterSpectralFlat&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;master_flat_spec.fits&#39;</span><span class="p">}</span>
<span class="linenos"> 9</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterRectWave&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">J</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">J</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;rect_wpoly_MOSlibrary_grism_J_filter_J.json&#39;</span><span class="p">}</span>
<span class="linenos">10</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterRectWave&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">H</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">H</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;rect_wpoly_MOSlibrary_grism_H_filter_H.json&#39;</span><span class="p">}</span>
<span class="linenos">11</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterRectWave&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">K</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">Ksp</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;rect_wpoly_MOSlibrary_grism_K_filter_Ksp.json&#39;</span><span class="p">}</span>
<span class="linenos">12</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterRectWave&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">LR</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">YJ</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;rect_wpoly_MOSlibrary_grism_LR_filter_YJ.json&#39;</span><span class="p">}</span>
<span class="linenos">13</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterRectWave&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">LR</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">HK</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;rect_wpoly_MOSlibrary_grism_LR_filter_HK.json&#39;</span><span class="p">}</span>
<span class="linenos">14</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RefinedBoundaryModelParam&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">J</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">J</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;final_multislit_bound_param_grism_J_filter_J.json&#39;</span><span class="p">}</span>
<span class="linenos">15</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RefinedBoundaryModelParam&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">H</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">H</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;final_multislit_bound_param_grism_H_filter_H.json&#39;</span><span class="p">}</span>
<span class="linenos">16</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RefinedBoundaryModelParam&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">K</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">Ksp</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;final_multislit_bound_param_grism_K_filter_Ksp.json&#39;</span><span class="p">}</span>
<span class="linenos">17</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RefinedBoundaryModelParam&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">LR</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">YJ</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;final_multislit_bound_param_grism_LR_filter_YJ.json&#39;</span><span class="p">}</span>
<span class="linenos">18</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RefinedBoundaryModelParam&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">LR</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">HK</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;final_multislit_bound_param_grism_LR_filter_HK.json&#39;</span><span class="p">}</span>
<span class="linenos">19</span>    <span class="mi">443</span><span class="n">fc0d1</span><span class="o">-</span><span class="n">e09a</span><span class="o">-</span><span class="mi">48</span><span class="n">cc</span><span class="o">-</span><span class="n">a0fd</span><span class="o">-</span><span class="mi">02</span><span class="n">be6f399da2</span><span class="p">:</span>  <span class="c1"># H2RG detector</span>
<span class="linenos">20</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterBadPixelMask&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;master_bpm_zeros.fits&#39;</span><span class="p">}</span>
<span class="linenos">21</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterDark&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;master_dark_zeros.fits&#39;</span><span class="p">}</span>
<span class="linenos">22</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterIntensityFlat&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;master_flat_spec_H2RG.fits&#39;</span><span class="p">}</span>
<span class="linenos">23</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterSpectralFlat&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;master_flat_spec_H2RG.fits&#39;</span><span class="p">}</span>
<span class="linenos">24</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterRectWave&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">J</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">J</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;rect_wpoly_MOSlibrary_grism_J_filter_J.json&#39;</span><span class="p">}</span>
<span class="linenos">25</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterRectWave&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">H</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">H</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;rect_wpoly_MOSlibrary_grism_H_filter_H.json&#39;</span><span class="p">}</span>
<span class="linenos">26</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterRectWave&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">K</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">Ksp</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;rect_wpoly_MOSlibrary_grism_K_filter_Ksp.json&#39;</span><span class="p">}</span>
<span class="linenos">27</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterRectWave&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">LR</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">YJ</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;rect_wpoly_MOSlibrary_grism_LR_filter_YJ.json&#39;</span><span class="p">}</span>
<span class="linenos">28</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;MasterRectWave&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">LR</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">HK</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;rect_wpoly_MOSlibrary_grism_LR_filter_HK.json&#39;</span><span class="p">}</span>
<span class="linenos">29</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RefinedBoundaryModelParam&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">J</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">J</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;final_multislit_bound_param_grism_J_filter_J.json&#39;</span><span class="p">}</span>
<span class="linenos">30</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RefinedBoundaryModelParam&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">H</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">H</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;final_multislit_bound_param_grism_H_filter_H.json&#39;</span><span class="p">}</span>
<span class="linenos">31</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RefinedBoundaryModelParam&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">K</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">Ksp</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;final_multislit_bound_param_grism_K_filter_Ksp.json&#39;</span><span class="p">}</span>
<span class="linenos">32</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RefinedBoundaryModelParam&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">LR</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">YJ</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;final_multislit_bound_param_grism_LR_filter_YJ.json&#39;</span><span class="p">}</span>
<span class="linenos">33</span>    <span class="o">-</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RefinedBoundaryModelParam&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">grism</span><span class="p">:</span> <span class="n">LR</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">HK</span><span class="p">},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;final_multislit_bound_param_grism_LR_filter_HK.json&#39;</span><span class="p">}</span>
<span class="linenos">34</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos">35</span>  <span class="n">EMIR</span><span class="p">:</span>
<span class="linenos">36</span>    <span class="mi">225</span><span class="n">fcaf2</span><span class="o">-</span><span class="mi">7</span><span class="n">f6f</span><span class="o">-</span><span class="mi">49</span><span class="n">cc</span><span class="o">-</span><span class="mi">972</span><span class="n">a</span><span class="o">-</span><span class="mi">70</span><span class="n">fd0aee8e96</span><span class="p">:</span>  <span class="c1"># original EMIR detector</span>
<span class="linenos">37</span>      <span class="n">default</span><span class="p">:</span>
<span class="linenos">38</span>       <span class="n">FULL_DITHERED_IMAGE</span><span class="p">:</span>
<span class="linenos">39</span>        <span class="o">-</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">&#39;x_offsets&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;ref_object_pos.txt&#39;</span><span class="p">}</span>
<span class="linenos">40</span>    <span class="mi">443</span><span class="n">fc0d1</span><span class="o">-</span><span class="n">e09a</span><span class="o">-</span><span class="mi">48</span><span class="n">cc</span><span class="o">-</span><span class="n">a0fd</span><span class="o">-</span><span class="mi">02</span><span class="n">be6f399da2</span><span class="p">:</span>  <span class="c1"># H2RG detector</span>
<span class="linenos">41</span>      <span class="n">default</span><span class="p">:</span>
<span class="linenos">42</span>       <span class="n">FULL_DITHERED_IMAGE</span><span class="p">:</span>
<span class="linenos">43</span>        <span class="o">-</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">&#39;x_offsets&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{},</span> <span class="n">content</span><span class="p">:</span> <span class="s1">&#39;ref_object_pos.txt&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Starting from March 2024, the format of this file has been updated to include calibrations for both the original EMIR detector and the subsequent replacement, the H2RG detector.</p>
<p><strong>Numina execution</strong></p>
<p>You are ready to execute the reduction recipe indicated in the file
<code class="docutils literal notranslate"><span class="pre">dithered_ini.yaml</span></code> (in this case the reduccion recipe named
<code class="docutils literal notranslate"><span class="pre">STARE_IMAGE</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ numina run dithered_ini.yaml -r control.yaml
...
...
</pre></div>
</div>
<p>After the execution of the previous command line, two subdirectories for each
block should have appeared:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ ls
control.yaml              obsid_0001877565_results/ obsid_0001877601_work/
data/                     obsid_0001877565_work/    obsid_0001877607_results/
dithered_ini.yaml         obsid_0001877571_results/ obsid_0001877607_work/
dithered_v0.yaml          obsid_0001877571_work/    obsid_0001877613_results/
dithered_v1.yaml          obsid_0001877577_results/ obsid_0001877613_work/
dithered_v2.yaml          obsid_0001877577_work/    obsid_0001877619_results/
dithered_v3.yaml          obsid_0001877583_results/ obsid_0001877619_work/
dithered_v4.yaml          obsid_0001877583_work/    obsid_0001877625_results/
dithered_v5.yaml          obsid_0001877589_results/ obsid_0001877625_work/
obsid_0001877553_results/ obsid_0001877589_work/    obsid_0001877631_results/
obsid_0001877553_work/    obsid_0001877595_results/ obsid_0001877631_work/
obsid_0001877559_results/ obsid_0001877595_work/
obsid_0001877559_work/    obsid_0001877601_results/
</pre></div>
</div>
<p><strong>The</strong> <code class="docutils literal notranslate"><span class="pre">work</span></code> <strong>subdirectories</strong></p>
<p>All the relevant images (scientific and calibrations) involved in the reduction
of a particular block of the observation result file are copied into the
<code class="docutils literal notranslate"><span class="pre">work</span></code> subdirectories in order to preserve the original files.</p>
<p>In particular, for the first block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ tree obsid_0001877553_work/
obsid_0001877553_work/
├── 0001877553-20181217-EMIR-STARE_IMAGE.fits
├── index.pkl
├── mask_bpm.fits
├── master_dark_zeros.fits
└── master_flatframe.fits
</pre></div>
</div>
<p><em>When disk space is an issue, it is possible to execute numina indicating that
links (instead of actual copies of the original raw files) must be placed in
the</em> <code class="docutils literal notranslate"><span class="pre">work</span></code> <em>subdirectory.</em> This behaviour is set using the parameter
<code class="docutils literal notranslate"><span class="pre">--link-files</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ numina run dithered_ini.yaml --link-files -r control.yaml
...
...

(emir) $ tree obsid_0001877553_work/
obsid_0001877553_work/
├── 0001877553-20181217-EMIR-STARE_IMAGE.fits -&gt; /Users/cardiel/w/GTC/emir/work/z_tutorials_201907/x/data/0001877553-20181217-EMIR-STARE_IMAGE.fits
├── index.pkl
├── master_bpm.fits -&gt; /Users/cardiel/w/GTC/emir/work/z_tutorials_201907/x/data/master_bpm.fits
├── master_dark_zeros.fits -&gt; /Users/cardiel/w/GTC/emir/work/z_tutorials_201907/x/data/master_dark_zeros.fits
└── master_flat_spec.fits -&gt; /Users/cardiel/w/GTC/emir/work/z_tutorials_201907/x/data/master_flat_spec.fits
</pre></div>
</div>
<p><strong>The</strong> <code class="docutils literal notranslate"><span class="pre">results</span></code> <strong>subdirectories</strong></p>
<p>These subdirectories store the result of the execution of the reduction
recipes. In particular, for the first block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree obsid_0001877553_results/
obsid_0001877553_results/
├── processing.log
├── reduced_image.fits
├── result.json
└── task.json
</pre></div>
</div>
<p>Note that although all the reduced images receive the same name in all these
<code class="docutils literal notranslate"><span class="pre">results</span></code> subdirectories (for this reduction recipe <code class="docutils literal notranslate"><span class="pre">reduced_image.fits</span></code>),
there is no confusion because the subdirectory name contains a unique label for
each block in the observation result file.</p>
</section>
<section id="step-2-image-combination">
<h2>Step 2: image combination<a class="headerlink" href="#step-2-image-combination" title="Permalink to this heading"></a></h2>
<p>After the basic reduction performed in step 1, we can proceed with the
combination of the images. For that purpose a different reduction recipe must
be employed: <code class="docutils literal notranslate"><span class="pre">FULL_DITHERED_IMAGE</span></code>.</p>
<p>This task is carried out using a new
observation result file: <code class="docutils literal notranslate"><span class="pre">dithered_v0.yaml</span></code>: the first 125 lines of this new
file are the same as the content of the the previous file
<code class="docutils literal notranslate"><span class="pre">dithered_ini.yaml</span></code>, but setting <code class="docutils literal notranslate"><span class="pre">enabled:</span> <span class="pre">False</span></code> in each of the 14 blocks.
This flag indicates that the execution of the recipe <code class="docutils literal notranslate"><span class="pre">STARE_IMAGE</span></code> is no
longer necessary in any of the 14 blocks. <strong>Note however that these blocks must
explicitly appear in the observation result file, even though they imply no
actual reduction, because they define the location of the previously reduced
images</strong>.</p>
<p>The new observation result file <code class="docutils literal notranslate"><span class="pre">dithered_v0.yaml</span></code> contains a new block at
the end (see lines 127-149 below), that is responsible of the execution of the
combination of the previously reduced images:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877553</span>
<span class="linenos">  2</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos">  3</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos">  4</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos">  5</span> <span class="o">-</span> <span class="mi">0001877553</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos">  6</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos">  7</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos">  8</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos">  9</span><span class="o">---</span>
<span class="linenos"> 10</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877559</span>
<span class="linenos"> 11</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 12</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 13</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 14</span> <span class="o">-</span> <span class="mi">0001877559</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 15</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 16</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 17</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos"> 18</span><span class="o">---</span>
<span class="linenos"> 19</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877565</span>
<span class="linenos"> 20</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 21</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 22</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 23</span> <span class="o">-</span> <span class="mi">0001877565</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 24</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 25</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 26</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos"> 27</span><span class="o">---</span>
<span class="linenos"> 28</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877571</span>
<span class="linenos"> 29</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 30</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 31</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 32</span> <span class="o">-</span> <span class="mi">0001877571</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 33</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 34</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 35</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos"> 36</span><span class="o">---</span>
<span class="linenos"> 37</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877577</span>
<span class="linenos"> 38</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 39</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 40</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 41</span> <span class="o">-</span> <span class="mi">0001877577</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 42</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 43</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 44</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos"> 45</span><span class="o">---</span>
<span class="linenos"> 46</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877583</span>
<span class="linenos"> 47</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 48</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 49</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 50</span> <span class="o">-</span> <span class="mi">0001877583</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 51</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 52</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 53</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos"> 54</span><span class="o">---</span>
<span class="linenos"> 55</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877589</span>
<span class="linenos"> 56</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 57</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 58</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 59</span> <span class="o">-</span> <span class="mi">0001877589</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 60</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 61</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 62</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos"> 63</span><span class="o">---</span>
<span class="linenos"> 64</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877595</span>
<span class="linenos"> 65</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 66</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 67</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 68</span> <span class="o">-</span> <span class="mi">0001877595</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 69</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 70</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 71</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos"> 72</span><span class="o">---</span>
<span class="linenos"> 73</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877601</span>
<span class="linenos"> 74</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 75</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 76</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 77</span> <span class="o">-</span> <span class="mi">0001877601</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 78</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 79</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 80</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos"> 81</span><span class="o">---</span>
<span class="linenos"> 82</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877607</span>
<span class="linenos"> 83</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 84</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 85</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 86</span> <span class="o">-</span> <span class="mi">0001877607</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 87</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 88</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 89</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos"> 90</span><span class="o">---</span>
<span class="linenos"> 91</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877613</span>
<span class="linenos"> 92</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos"> 93</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos"> 94</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos"> 95</span> <span class="o">-</span> <span class="mi">0001877613</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos"> 96</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos"> 97</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos"> 98</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos"> 99</span><span class="o">---</span>
<span class="linenos">100</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877619</span>
<span class="linenos">101</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos">102</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos">103</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos">104</span> <span class="o">-</span> <span class="mi">0001877619</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos">105</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos">106</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos">107</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos">108</span><span class="o">---</span>
<span class="linenos">109</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877625</span>
<span class="linenos">110</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos">111</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos">112</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos">113</span> <span class="o">-</span> <span class="mi">0001877625</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos">114</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos">115</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos">116</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos">117</span><span class="o">---</span>
<span class="linenos">118</span><span class="nb">id</span><span class="p">:</span> <span class="n">_0001877631</span>
<span class="linenos">119</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
<span class="linenos">120</span><span class="n">mode</span><span class="p">:</span> <span class="n">STARE_IMAGE</span>
<span class="linenos">121</span><span class="n">frames</span><span class="p">:</span>
<span class="linenos">122</span> <span class="o">-</span> <span class="mi">0001877631</span><span class="o">-</span><span class="mi">20181217</span><span class="o">-</span><span class="n">EMIR</span><span class="o">-</span><span class="n">STARE_IMAGE</span><span class="o">.</span><span class="n">fits</span>
<span class="linenos">123</span><span class="n">requirements</span><span class="p">:</span>
<span class="linenos">124</span>  <span class="n">reprojection_method</span><span class="p">:</span> <span class="n">interp</span>
<span class="linenos">125</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">False</span>
<span class="linenos">126</span><span class="o">---</span>
<span class="hll"><span class="linenos">127</span><span class="nb">id</span><span class="p">:</span> <span class="n">_combined_v0</span>
</span><span class="hll"><span class="linenos">128</span><span class="n">instrument</span><span class="p">:</span> <span class="n">EMIR</span>
</span><span class="hll"><span class="linenos">129</span><span class="n">mode</span><span class="p">:</span> <span class="n">FULL_DITHERED_IMAGE</span>
</span><span class="hll"><span class="linenos">130</span><span class="n">children</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">131</span> <span class="o">-</span> <span class="n">_0001877553</span>
</span><span class="hll"><span class="linenos">132</span> <span class="o">-</span> <span class="n">_0001877559</span>
</span><span class="hll"><span class="linenos">133</span> <span class="o">-</span> <span class="n">_0001877565</span>
</span><span class="hll"><span class="linenos">134</span> <span class="o">-</span> <span class="n">_0001877571</span>
</span><span class="hll"><span class="linenos">135</span> <span class="o">-</span> <span class="n">_0001877577</span>
</span><span class="hll"><span class="linenos">136</span> <span class="o">-</span> <span class="n">_0001877583</span>
</span><span class="hll"><span class="linenos">137</span> <span class="o">-</span> <span class="n">_0001877589</span>
</span><span class="hll"><span class="linenos">138</span> <span class="o">-</span> <span class="n">_0001877595</span>
</span><span class="hll"><span class="linenos">139</span> <span class="o">-</span> <span class="n">_0001877601</span>
</span><span class="hll"><span class="linenos">140</span> <span class="o">-</span> <span class="n">_0001877607</span>
</span><span class="hll"><span class="linenos">141</span> <span class="o">-</span> <span class="n">_0001877613</span>
</span><span class="hll"><span class="linenos">142</span> <span class="o">-</span> <span class="n">_0001877619</span>
</span><span class="hll"><span class="linenos">143</span> <span class="o">-</span> <span class="n">_0001877625</span>
</span><span class="hll"><span class="linenos">144</span> <span class="o">-</span> <span class="n">_0001877631</span>
</span><span class="hll"><span class="linenos">145</span><span class="n">requirements</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">146</span>  <span class="n">iterations</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="hll"><span class="linenos">147</span>  <span class="n">sky_images</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="hll"><span class="linenos">148</span>  <span class="n">refine_offsets</span><span class="p">:</span> <span class="kc">False</span>
</span><span class="hll"><span class="linenos">149</span><span class="n">enabled</span><span class="p">:</span> <span class="kc">True</span>
</span></pre></div>
</div>
<p>The new block (lines 127-149) indicates that the reduction recipe
<code class="docutils literal notranslate"><span class="pre">FULL_DITHERED_IMAGE</span></code> must be executed using as input the results of the
previous blocks. In particular, the <code class="docutils literal notranslate"><span class="pre">id's</span></code> of the initial 14 blocks are given
under the <code class="docutils literal notranslate"><span class="pre">children:</span></code> keyword (lines 131 to 144).</p>
<p>In addition, a few parameters (which will be modified later) are set to some
default values in this initial combination:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">iterations:</span> <span class="pre">0</span></code>: this parameter indicates whether an object mask is
employed or not. A value of <code class="docutils literal notranslate"><span class="pre">0</span></code> means that no object mask is computed. Note
that an object mask allows a better sky background determination since bright
objects are removed prior to the sky signal estimation. When this parameter
is greater than zero, an object mask is created by performing a
SEXtractor-like object search in the resulting image at the end of the
previous iteration.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sky_images:</span> <span class="pre">0</span></code>: number of images employed to determine the sky background
of each pixel. Setting this parameter to <code class="docutils literal notranslate"><span class="pre">0</span></code> indicates that the sky
background is simply computed as the median value in the same image in which
the pixel background is being estimated. Using a value larger than zero sets
the number of closest images (in time) where the signal of a particular pixel
is averaged (for example, a value of <code class="docutils literal notranslate"><span class="pre">6</span></code> will tipically mean that the sky
background will be estimated using 3 images acquired before and 3 images
acquired after the current one; note that at the beginning and at the end of
a given observation sequence, the closest nearby images correspond to
exposures obtained only after or only before the current one, respectively).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">refine_offsets:</span> <span class="pre">False</span></code>: this flag indicates whether the offsets between
images must be refined using cross-correlation of subimages around the
brightest objects.</p></li>
</ul>
<p>As it will be explained later, the use of these parameters can help to obtain
better results. So far we are only interested in showing a fast way to generate
a combined image.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">dithered_v0.yaml</span></code> can also be automatically generated using
the same script previously mentioned in step 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ pyemir-generate_yaml_for_dithered_image \
  data/list_images.txt --step 1 --repeat 1 \
  --reprojection interp \
  --obsid_combined combined_v0 \
  --outfile dithered_v0.yaml
</pre></div>
</div>
<p>Note that here we are using <code class="docutils literal notranslate"><span class="pre">--step</span> <span class="pre">1</span></code> instead of <code class="docutils literal notranslate"><span class="pre">--step</span> <span class="pre">0</span></code>. In
addition, a new parameter <code class="docutils literal notranslate"><span class="pre">--obsid_combined</span> <span class="pre">combined_v0</span></code> has also been
employed in order to set the <code class="docutils literal notranslate"><span class="pre">id</span></code> of the block responsible for the
execution of the combination recipe.</p>
<p>Do not miss the <code class="docutils literal notranslate"><span class="pre">--repeat</span> <span class="pre">&lt;NEXP&gt;</span></code> parameter (in this example
<code class="docutils literal notranslate"><span class="pre">NEXP=1</span></code>).</p>
</div>
<p>The combination of the images is finally performed using numina:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ numina run dithered_v0.yaml --link-files -r control.yaml
</pre></div>
</div>
<p>The previous execution also generates two auxiliary subdirectories <code class="docutils literal notranslate"><span class="pre">work</span></code> and
<code class="docutils literal notranslate"><span class="pre">results</span></code>. The resulting combined image can be found in
<code class="docutils literal notranslate"><span class="pre">obsid_combined_v0_result/reduced_image.fits</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ tree obsid_combined_v0_results/
obsid_combined_v0_results/
├── processing.log
├── reduced_image.fits
├── result.json
└── task.json
</pre></div>
</div>
<p>You can display the image using <code class="docutils literal notranslate"><span class="pre">ds9</span></code>, using <code class="docutils literal notranslate"><span class="pre">numina-ximshow</span></code> (the display
tool shipped with numina based on matplotlib), or with any other tool:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(emir) $ numina-ximshow obsid_combined_v0_results/reduced_image.fits
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/combined_v0_trimmed.png"><img alt="combined image, version 0" src="../_images/combined_v0_trimmed.png" style="width: 100%;" /></a>
<p>It is clear that this combined image is far from perfect. In particular, there
are inhomogeneities in the background level, which are easier to see at the
image borders. In addition, the objects appear elongated, which indicates that
the offsets between individual exposures, determined from the WCS header
information, are not suficiently precise. The zoomed region shown in the next
image reveals that the problem is not negligible:</p>
<a class="reference internal image-reference" href="../_images/combined_v0_zoom_trimmed.png"><img alt="combined image, version 0" src="../_images/combined_v0_zoom_trimmed.png" style="width: 100%;" /></a>
<p>In addition, the superflatfield computed when combining the individual
exposures does exhibit a doughnut-like shape that must be taken account
(something that we have not yet done). In particular, the image
<code class="docutils literal notranslate"><span class="pre">obsid_combined_v0_work/superflat_comb_i0.fits</span></code> has the following aspect:</p>
<a class="reference internal image-reference" href="../_images/superflat_v0_trimmed.png"><img alt="superflatfield, version 0" src="../_images/superflat_v0_trimmed.png" style="width: 100%;" /></a>
<p>In the next section we are showing several alternatives to handle the previous
issues and improve the image combination.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Imaging mode tutorial: combination of dithered exposures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="refined_combination.html" class="btn btn-neutral float-right" title="Improving the image combination" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2024, Universidad Complutense de Madrid.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>