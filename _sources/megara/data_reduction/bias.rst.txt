Bias image
==========

Before the Analog-to-Digital conversion is performed, a pedestal (electronic) 
level is added to all images obtained with the MEGARA CCD. 
This is a standard procedure in CCD imaging and spectroscopy applications 
for Astronomy and is intended to minimize the ADC errors produced 
when very low analog values are converted to DUs. To calibrate 
this pedestal level of the detectors, bias images are takken with 
null integration time. We note the user that in the case of the 
MEGARACCD (a 4k x 4k pixels CCD231-84 E2V chip), since the detector is 
always read using two diagonally-opposed amplifiers (to speed up the reading 
process while minimizing electronic cross-talk), the bias is slightly 
different in the upper and bottom halves of the image. 
Note that the Readout Noise (RoN) should be around 2 e–in all cases. 
This recipe processes a set of bias images obtained in Bias Image 
instrument mode. Images are corrected from overscan and trimmed to the 
physical size of the detector. Then, they are corrected from Bad-pixelsMask, if the BPM is available and finally, images are stacked using the median.

This is an example for the 0_bias.yaml

::

    (megara) bash-3.2$ more 0_bias.yaml 
    id: 0_bias
    mode: MegaraBiasImage
    instrument: MEGARA
    frames:
    -0001310880-20170827-MEGARA-MegaraBiasImage.fits
    -0001310881-20170827-MEGARA-MegaraBiasImage.fits
    -0001310882-20170827-MEGARA-MegaraBiasImage.fits
    -0001310883-20170827-MEGARA-MegaraBiasImage.fits
    -0001310884-20170827-MEGARA-MegaraBiasImage.fits
    -0001310885-20170827-MEGARA-MegaraBiasImage.fits
    -0001310886-20170827-MEGARA-MegaraBiasImage.fits
    -0001310887-20170827-MEGARA-MegaraBiasImage.fits
    -0001310888-20170827-MEGARA-MegaraBiasImage.fits

The recipe is run as follows:

::
    
    (megara) bash-3.2$ numina run 0_bias.yaml -r ../control.yaml

and the products are stored in the directory obsid0_bias_results/, including 
the master_bias.fits file (see Figure 4). The  user  needs  to  copy  this  
file  to  the  calibration  tree at 
ca3558e3-e50d-4bbc-86bd-da50a0998a48/MasterBias/.

:: 


    (megara) bash-3.2$ tree obsid0_bias_work/ 
    obsid0_bias_results/obsid0_bias_work/
    ├── 0001310880-20170827-MEGARA-MegaraBiasImage.fits
    ├── 0001310881-20170827-MEGARA-MegaraBiasImage.fits
    ├── 0001310882-20170827-MEGARA-MegaraBiasImage.fits
    ├── 0001310883-20170827-MEGARA-MegaraBiasImage.fits
    ├── 0001310884-20170827-MEGARA-MegaraBiasImage.fits
    ├── 0001310885-20170827-MEGARA-MegaraBiasImage.fits
    ├── 0001310886-20170827-MEGARA-MegaraBiasImage.fits
    ├── 0001310887-20170827-MEGARA-MegaraBiasImage.fits
    ├── 0001310888-20170827-MEGARA-MegaraBiasImage.fits
    ├── index.pkl
    └── master_bpm.fit
    obsid0_bias_results/
    ├── master_bias.fits
    ├── processing.log
    ├── result.yaml
    └── task.yaml

.. figure:: Figure_4.png
   
   Example of a MEGARA master bias as created by the MegaraBiasImage recipe.
   Note that this image was obtained with the MEGARA DRP ver. 0.9. 
   Later versions fit a spline to the overscan regions of both amplifiers 
   (instead of adopting a constant value) so the resulting MegaraBias 
   image is typically flatter than the example shown here.

